<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDL Institute - Prototype Viewer</title>
    <link rel="icon" href="assets/favicon.png" />

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css">
    <style>
        /* Viewer-specific styles from guideline.md */
        body { font-family: 'Inter', system-ui, sans-serif; }
        .sidebar-link { color: #3f3f46; transition: background-color 150ms ease-in-out, color 150ms ease-in-out; }
        .sidebar-link:hover { background-color: #e4e4e7; color: #18181b; }
        .sidebar-link.active { background-color: #18181b; color: #ffffff; font-weight: 600; }
        .sidebar-link.active:hover { background-color: #27272a; }
        summary { list-style: none; cursor: pointer; }
        summary::-webkit-details-marker { display: none; }
        
        #preview-container { 
            transition: all 300ms ease-in-out; 
        }
        
        .mobile-frame {
            width: 375px;
            height: 812px;
            max-width: 375px;
            max-height: 812px;
        }

        .desktop-adaptive {
            width: 100%;
            height: 100%;
            max-width: 100%;
            max-height: 100%;
        }
    </style>
</head>
<body class="bg-zinc-100 text-zinc-900">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="w-72 bg-white border-r border-zinc-200 flex flex-col">
            <div class="p-4 border-b border-zinc-200 h-16 flex items-center">
                <div class="flex items-center gap-3">
                    <img src="assets/shield-fill-dark.svg" alt="CDL Institute Logo" class="h-9 w-9">
                    <h1 class="text-lg font-bold">CDL Institute</h1>
                </div>
            </div>
            <nav class="flex-grow overflow-y-auto">
                <ul class="p-2 space-y-1 text-sm">
                    
                    <!-- Group: Free User Flow -->
                    <details open>
                        <summary class="p-2 font-semibold text-xs text-zinc-500 uppercase tracking-wider flex items-center gap-2">
                            <i class="ri-user-line text-base text-blue-600"></i>
                            <span>Free User Flow</span>
                        </summary>
                        <ul class="pl-2 pt-1 space-y-1">
                            <li><a href="home.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">1. Arrives on Homepage</a></li>
                            <li><a href="03-assessment-intro.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">2. Starts Free Assessment</a></li>
                            <li><a href="assessment.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">3. Takes Assessment</a></li>
                            <li><a href="15-test-results.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">4. Sees Assessment Results</a></li>
                            <li><a href="auth.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">5. Creates Free Account</a></li>
                            <li><a href="02-segment-selection.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">6. Onboarding: Selects Class</a></li>
                            <li><a href="06-path-customization.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">7. Onboarding: Customizes Path</a></li>
                            <li><a href="07-dashboard-free.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">8. Lands on Free Dashboard</a></li>
                            <li><a href="gate-upgrade.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">9. Hits Upgrade Gate</a></li>
                            <li><a href="pricing.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">10. Views Pricing Page</a></li>
                        </ul>
                    </details>

                    <!-- Group: Paid User Flow -->
                    <details open>
                        <summary class="p-2 font-semibold text-xs text-zinc-500 uppercase tracking-wider flex items-center gap-2">
                            <i class="ri-star-fill text-base text-amber-500"></i>
                            <span>Paid User Flow</span>
                        </summary>
                        <ul class="pl-2 pt-1 space-y-1">
                            <li><a href="pricing.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">1. Chooses Plan on Pricing</a></li>
                            <li><a href="auth.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">2. Creates Account</a></li>
                            <li><a href="02-segment-selection.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">3. Onboarding: Selects Class</a></li>
                            <li><a href="06-path-customization.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">4. Onboarding: Customizes Path</a></li>
                            <li><a href="07-dashboard-paid.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">5. Lands on Paid Dashboard</a></li>
                            <li><a href="13-practice-tests.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">6. Accesses All Practice Tests</a></li>
                            <li><a href="11-progress-report.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">7. Views Full Progress Report</a></li>
                        </ul>
                    </details>

                    <!-- Group: Standalone & Utility Screens -->
                    <details>
                        <summary class="p-2 font-semibold text-xs text-zinc-500 uppercase tracking-wider flex items-center gap-2">
                            <i class="ri-tools-fill text-base"></i>
                            <span>Utility & Standalone</span>
                        </summary>
                        <ul class="pl-2 pt-1 space-y-1">
                            <li><a href="auth.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">Authentication</a></li>
                            <li><a href="guideline.md" target="preview-frame" class="sidebar-link block p-2 rounded-md">Design Guideline</a></li>
                        </ul>
                    </details>

                    <!-- Group: Question Component Gallery -->
                    <details>
                        <summary class="p-2 font-semibold text-xs text-zinc-500 uppercase tracking-wider flex items-center gap-2">
                            <i class="ri-gallery-fill text-base"></i>
                            <span>Question Gallery</span>
                        </summary>
                        <ul class="pl-2 pt-1 space-y-1">
                            <li><a href="14a-mcq.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">MCQ</a></li>
                            <li><a href="14b-media-mcq.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">Media MCQ</a></li>
                            <li><a href="14c-checkboxes.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">Checkboxes</a></li>
                            <li><a href="14d-numeric-input.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">Numeric Input</a></li>
                            <li><a href="14e-hotspot.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">Hotspot</a></li>
                            <li><a href="14f-dropdown.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">Dropdown</a></li>
                            <li><a href="14g-short-text.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">Short Text</a></li>
                            <li><a href="14h-true-false.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">True/False</a></li>
                            <li><a href="14i-sequencing.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">Sequencing</a></li>
                            <li><a href="14j-matching.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">Matching</a></li>
                            <li><a href="14k-slider.html" target="preview-frame" class="sidebar-link block p-2 rounded-md">Slider/Range</a></li>
                        </ul>
                    </details>
                </ul>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 flex flex-col p-4 sm:p-6 lg:p-8 overflow-y-auto">
            <div class="flex-shrink-0 flex justify-between items-center mb-4 h-16">
                <div id="screen-title-container" class="flex items-center gap-3 text-lg font-semibold text-zinc-900">
                    <!-- Title will be populated by JS -->
                </div>
                <div class="flex items-center gap-2 p-1 bg-zinc-200 rounded-lg">
                    <button id="mobile-view-btn" class="px-3 py-1 text-sm font-semibold bg-white text-zinc-900 rounded-md shadow-sm">Mobile</button>
                    <button id="desktop-view-btn" class="px-3 py-1 text-sm font-semibold text-zinc-600">Desktop</button>
                </div>
            </div>
            <div class="flex-grow flex items-center justify-center">
                <div id="preview-container" class="bg-white rounded-3xl shadow-2xl ring-8 ring-zinc-900 mobile-frame">
                    <iframe name="preview-frame" class="w-full h-full rounded-[22px]" frameborder="0"></iframe>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function( ) {
            const links = document.querySelectorAll('.sidebar-link');
            const iframe = document.querySelector('iframe[name="preview-frame"]');
            const screenTitleContainer = document.getElementById('screen-title-container');
            const mobileBtn = document.getElementById('mobile-view-btn');
            const desktopBtn = document.getElementById('desktop-view-btn');
            const previewContainer = document.getElementById('preview-container');
            const storageKey = 'cdl-prototype-last-page';

            function updateActiveLink(activeLink) {
                if (!activeLink) return;
                
                // Update active state in sidebar
                links.forEach(l => l.classList.remove('active'));
                activeLink.classList.add('active');
                
                // Update iframe source
                iframe.src = activeLink.href;
                
                // Update header title with clickable URL
                const pageName = activeLink.textContent.trim();
                const pageUrl = activeLink.getAttribute('href');
                screenTitleContainer.innerHTML = `
                    <span>${pageName}</span>
                    <a href="${pageUrl}" target="_blank" title="Open ${pageUrl} in new tab" class="font-mono font-normal text-sm text-zinc-400 hover:text-blue-600 hover:underline">
                        ${pageUrl}
                    </a>
                `;
                
                // **NEW: Save the active URL to localStorage**
                localStorage.setItem(storageKey, pageUrl);
            }

            // **NEW: Function to load the initial state**
            function loadInitialState() {
                const savedUrl = localStorage.getItem(storageKey);
                let linkToLoad = null;

                if (savedUrl) {
                    // Find the link that matches the saved URL
                    linkToLoad = document.querySelector(`.sidebar-link[href="${savedUrl}"]`);
                }

                // If no saved link is found, or it's the first visit, load the first link in the list
                if (!linkToLoad) {
                    linkToLoad = document.querySelector('.sidebar-link');
                }

                if (linkToLoad) {
                    // Use a small timeout to ensure the iframe is ready
                    setTimeout(() => {
                        updateActiveLink(linkToLoad);
                    }, 100);
                }
            }

            // Add click listeners to all sidebar links
            links.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault(); 
                    updateActiveLink(this);
                });
            });

            // Viewport toggle logic
            mobileBtn.addEventListener('click', () => {
                previewContainer.classList.remove('desktop-adaptive');
                previewContainer.classList.add('mobile-frame');
                mobileBtn.classList.add('bg-white', 'text-zinc-900', 'shadow-sm');
                mobileBtn.classList.remove('text-zinc-600');
                desktopBtn.classList.remove('bg-white', 'text-zinc-900', 'shadow-sm');
                desktopBtn.classList.add('text-zinc-600');
            });

            desktopBtn.addEventListener('click', () => {
                previewContainer.classList.remove('mobile-frame');
                previewContainer.classList.add('desktop-adaptive');
                desktopBtn.classList.add('bg-white', 'text-zinc-900', 'shadow-sm');
                desktopBtn.classList.remove('text-zinc-600');
                mobileBtn.classList.remove('bg-white', 'text-zinc-900', 'shadow-sm');
                mobileBtn.classList.add('text-zinc-600');
            });

            // **NEW: Call the function to load the initial state**
            loadInitialState();
        });
    </script>
</body>
</html>
